<script type="text/javascript-lazy">
    var app = angular.module('ctw');
    app.controllerProvider.register('toolController', function ($scope) {
        var initial = {
            height: undefined,
            imperial_feet: undefined,
            imperial_inches: undefined,

            age: undefined,
            weight: undefined,
            sex: "male",

            result: undefined,
            error: undefined
        }

        $scope.bmr = angular.copy(initial);
        $scope.units = "Metric";
        $scope.calculate = function () {
            var scope = $scope.bmr;
            if (validateDecimal(scope.age) && validateDecimal(scope.weight)) {
                var weight;
                var height;
                var age = scope.age;
                if ($scope.units === 'Imperial' && (validateDecimal(scope.imperial_feet) || validateDecimal(scope.imperial_inches))) {
                    height = (scope.imperial_feet || 0) * 30.48 + (scope.imperial_inches || 0) * 2.54;
                    weight = scope.weight / 2.20462262;
                } else if ($scope.units === 'Metric' && validateDecimal(scope.height)) {
                    height = scope.height;
                    weight = scope.weight;
                } else {
                    scope.error = 'Missing or invalid Input';
                    return;
                }

                var calories;
                if (scope.sex === 'male') {
                    calories = bmrMen(height, weight, age);
                } else if (scope.sex === 'female') {
                    calories = bmrWomen(height, weight, age);
                } else {
                    scope.error = 'Please specifiy a gender';
                    return;
                }

                scope.result = {
                    kilocalories: calories.toFixed(0),
                    kilojoules: (calories / 4.184).toFixed(0),
                };
            } else {
                scope.error = 'Missing or invalid Input';
                return;
            }
        }

        $scope.reset = function () {
            $scope.bmr = angular.copy(initial);
        }

        var bmrWomen = function (height, weight, age) {
            return 10 * weight + 6.25 * height - 5 * age - 161;
        }
        var bmrMen = function (height, weight, age) {
            return 10 * weight + 6.25 * height - 5 * age + 5;
        }

        var validateDecimal = function (decimal) {
            decimal = parseFloat(decimal);
            return angular.isNumber(decimal) && isFinite(decimal);
        }
    })
    ;
</script>
<style>
    .gender-radio {
        text-align: left !important;
        display: inline-block !important;
        width: 100px !important;
    }

    .nowrap {
        white-space: nowrap;
    }
</style>
<h3>BMR & Calorie Calculator</h3>
<div ng-controller="toolController">
    <form class="pure-form pure-form-aligned" novalidate>
        <fieldset>
            <legend>Enter your information and click calculate.
                <a class="nowrap" href=""
                   ng-click="units === 'Imperial' ? units = 'Metric' : units = 'Imperial'; reset()">
                    {{units === 'Imperial' ? 'Use Metric' : 'Use Imperial'}}
                </a>
            </legend>
            <div class="pure-control-group">
                <label for="male">
                    Sex:
                </label>
                <input id="male" type="radio" name="sex" value="male" ng-model="bmr.sex" checked>
                <label for="male" class="gender-radio">
                    Male
                </label>
            </div>
            <div class="pure-control-group">
                <label for="female"></label>
                <input id="female" type="radio" name="sex" value="female" ng-model="bmr.sex">
                <label for="female" class="gender-radio">
                    Female
                </label>

            </div>
            <div class="pure-control-group" ng-show="units === 'Metric'">
                <label for="height">Height:</label>
                <input id="height" type="number" step="any" placeholder="cm"
                       ng-model="bmr.height">
            </div>
            <div class="pure-control-group" ng-show="units === 'Imperial'">
                <label for="height_imperial">Height:</label>
                <input id="height_imperial" type="number" step="any" placeholder="feet"
                       ng-model="bmr.imperial_feet"/>
            </div>
            <div class="pure-control-group" ng-show="units === 'Imperial'">
                <label for="height"></label>
                <input type="number" step="any" placeholder="inches"
                       ng-model="bmr.imperial_inches"/>
            </div>
            <div class="pure-control-group">
                <label for="age">Age:</label>
                <input id="age" type="number" step="any"
                       placeholder="age in years"
                       ng-model="bmr.age">
            </div>
            <div class="pure-control-group">
                <label for="weight">Weight:</label>
                <input id="weight" type="number" step="any"
                       placeholder="{{units === 'Imperial'?'lbs':'kg'}}"
                       ng-model="bmr.weight">
            </div>

            <button class="pure-button pure-button-primary" ng-click="calculate()">Calculate
            </button>
            <button class="pure-button" type="reset" ng-click="reset()">Clear
            </button>


            <div class="alert" ng-show="bmr.error !== undefined">
                <div class="alert_inner">
                    <div class="alert_text">{{bmr.error}}</div>
                    <div class="alert_dismiss" ng-click="bmr.error = undefined">&times;</div>
                </div>
            </div>
            <div ng-show="bmr.result">
                <p>Your Body needs <b>{{bmr.result.kilocalories}} Kilocalories</b> or {{bmr.result.kilojoules}}
                    Kilojoule a day to maintain your weight.</p>

                <table class="pure-table">
                    <thead>
                    <tr>
                        <th>You need...</th>
                        <th>To lose...</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>{{bmr.result.kilocalories - 500}} Kcal</td>
                        <td>{{units === 'Imperial'?'1 lbs':'1/2 kg'}} per week.</td>
                    </tr>
                    <tr>
                        <td>{{bmr.result.kilocalories - 1000}} Kcal</td>
                        <td>{{units === 'Imperial'?'2 lbs':'1 kg'}} per week.</td>
                    </tr>
                    </tbody>
                    <thead>
                    <tr>
                        <th>You need...</th>
                        <th>To gain...</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>{{bmr.result.kilocalories*1 + 500*1}} Kcal</td>
                        <td>{{units === 'Imperial'?'1 lbs':'1/2 kg'}} per week.</td>
                    </tr>
                    <tr>
                        <td>{{bmr.result.kilocalories*1 + 1000*1}} Kcal</td>
                        <td>{{units === 'Imperial'?'2 lbs':'1 kg'}} per week.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </fieldset>
    </form>
</div>
<hr/>
<div class="pure-g">
    <div class="pure-u-1 pure-u-md-1-3 text">
        <h4>Keywords</h4>

        <p>
            Mehr bei mehr aktivität usw.,
            BMR heißt Basic Metabolic Rate
        </p>
    </div>
    <div class="pure-u-1 pure-u-md-1-3 text">
        <h4>Lorem Ipsum</h4>

        <p>
            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
            dolore magna aliqua. Ut enim ad minim veniam.
        </p>
    </div>
    <div class="pure-u-1 pure-u-md-1-3 text">
        <h4>Lorem Ipsum</h4>

        <p>
            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
            dolore magna aliqua. Ut enim ad minim veniam.
        </p>
    </div>
</div>
</div>


