<script type="text/javascript-lazy">

    var app = angular.module('ctw');

    app.controllerProvider.register('toolController', function ($scope) {
        var calculatorInitial = {
            error: undefined,
            first: {n: undefined, d:undefined},
            operator: '+',
            second: {n: undefined, d:undefined},
            result: {n: 0, d:1}
        }
        $scope.calculate = angular.copy(calculatorInitial);
        var converterInitial = {
            error: undefined,
            first: {n: undefined, d:undefined, decimal:undefined},
            second: {n: undefined, d:undefined},
            third: {decimal:undefined}
        }
        $scope.convert = angular.copy(converterInitial);

        $scope.calculateFractions = function () {

            if (validateFraction($scope.calculate.first.n, $scope.calculate.first.d)
                    && validateFraction($scope.calculate.second.n, $scope.calculate.second.d)) {
                $scope.calculate.error = undefined;

                var f1 = Fraction($scope.calculate.first.n, $scope.calculate.first.d);
                var f2 = Fraction($scope.calculate.second.n, $scope.calculate.second.d);
                var fResult;

                switch ($scope.calculate.operator) {
                    case '+':
                        fResult = f1.add(f2);
                        break;
                    case '-':
                        fResult = f1.sub(f2);
                        break;
                    case '*':
                        fResult = f1.mul(f2);
                        break;
                    case '/':
                            if(Fraction.divisible(f1,f2)){
                                fResult = f1.div(f2);
                            } else {
                                $scope.calculate.error = 'Not divisible';
                            }
                        break;
                    default:
                        $scope.calculate.error = 'Please specify an operator';
                        return;
                }
                console.log(fResult);
                $scope.calculate.result = fResult;
            } else {
                $scope.calculate.error = "Wrong or missing Input.";
            }
        };

        $scope.convertFractions = function () {
            scope = $scope.convert;
            scope.error = undefined;

            var validInputs = {
                mixed: validateFraction(scope.first.n,scope.first.d) && validateDecimal(scope.first.decimal),
                fraction: validateFraction(scope.second.n,scope.second.d),
                decimal: validateDecimal(scope.third.decimal)
            }

            if (validInputs.mixed && !validInputs.fraction && !validInputs.decimal) {
                //TODO
                var mixedFraction = Fraction(scope.first.decimal + " " + scope.first.n + "/" + scope.first.d);
                scope.second = mixedFraction;
                scope.third = {decimal: (mixedFraction.n / mixedFraction.d)};
            } else if (!validInputs.mixed && validInputs.fraction && !validInputs.decimal) {
                //TODO
            } else if (!validInputs.mixed && !validInputs.fraction && validInputs.decimal) {
                //TODO
            } else if (!validInputs.mixed && !validInputs.fraction && !validInputs.decimal) {
                scope.error = 'Wrong or missing Input';
            } else {
                scope.error = 'Only one Input allowed';
            }
        }

        $scope.clearConverter = function () {
            $scope.convert = angular.copy(calculatorInitial);
        }
        $scope.clearCalculator = function () {
            $scope.calculate  = angular.copy(calculatorInitial);
        }

        var validateDecimal = function (decimal) {
            decimal = parseFloat(decimal);
            return angular.isNumber(decimal) && isFinite(decimal);
        }
        var validateFraction = function (numerator, denominator) {
            return validateDecimal(numerator) && validateDecimal(denominator) && denominator !== 0;
        };
    });
</script>
<style>
    .form-cell {
        display: inline-block;
        vertical-align: middle;
        text-align: center;
        width: 5%;
    }

    .form-cell input {
        max-width: 100%;
    }

    .wide-form-cell {
        width: 20%;
        white-space: nowrap;
    }

    /*Overriding pure*/
    .pure-input-1-2 {
        width: 100% !important;
    }

</style>
<h3>Percentage Calculator</h3>
<div ng-controller="toolController">
    <form class="pure-form">
        <fieldset>
            <legend>Calculate Fractions</legend>
            <div>
                <div class="form-cell wide-form-cell">
                    <fieldset class="pure-group">
                        <input type="number" step="any" class="pure-input-1-2" placeholder="Numerator"
                               ng-model="calculate.first.n">
                        <input type="number" step="any" class="pure-input-1-2" placeholder="Denominator"
                               ng-model="calculate.first.d">
                    </fieldset>
                </div>
                <div class="form-cell wide-form-cell">
                    <select ng-model="calculate.operator">
                        <option value="+">+</option>
                        <option value="-">-</option>
                        <option value="*">*</option>
                        <option value="/">/</option>
                    </select>
                </div>
                <div class="form-cell wide-form-cell">
                    <fieldset class="pure-group">
                        <input type="number" step="any" class="pure-input-1-2" placeholder="Numerator"
                               ng-model="calculate.second.n">
                        <input type="number" step="any" class="pure-input-1-2" placeholder="Denominator"
                               ng-model="calculate.second.d">
                    </fieldset>
                </div>
                <div class="form-cell">
                    <b>=</b>
                </div>
                <div class="form-cell wide-form-cell">
                    <b ng-show="calculate.result.s == '-1'">-</b>
                    <sup>{{calculate.result.n}}</sup>/<sub>{{calculate.result.d}}</sub>
                </div>
            </div>
            <div>
                <button class="pure-button pure-button-primary" ng-click="calculateFractions()">Calculate
                </button>
                <button class="pure-button pure-button-primary" ng-click="clearCalculator()">Clear
                </button>
            </div>
            <div class="alert" ng-show="calculate.error !== undefined">
                <div class="alert_inner">
                    <div class="alert_text">{{calculate.error}}</div>
                    <div class="alert_dismiss" ng-click="calculate.error = undefined">&times;</div>
                </div>
            </div>
        </fieldset>
    </form>
    <hr/>
    <form class="pure-form">
        <fieldset>
            <legend>Convert Mixed Fraction to Fraction to Decimal (Input one and click calculate)</legend>
            <div>
                <div class="form-cell wide-form-cell">
                    <input type="number" step="any" class="pure-input-1-2" placeholder="Decimal"
                           ng-model="convert.first.decimal">
                </div>
                <div class="form-cell wide-form-cell">
                    <fieldset class="pure-group">
                        <input type="number" step="any" class="pure-input-1-2" placeholder="Numerator"
                               ng-model="convert.first.n">
                        <input type="number" step="any" class="pure-input-1-2" placeholder="Denominator"
                               ng-model="convert.first.d">
                    </fieldset>
                </div>
                <div class="form-cell">
                    <b>=</b>
                </div>
                <div class="form-cell wide-form-cell">
                    <fieldset class="pure-group">
                        <input type="number" step="any" class="pure-input-1-2" placeholder="Numerator"
                               ng-model="convert.second.n">
                        <input type="number" step="any" class="pure-input-1-2" placeholder="Denominator"
                               ng-model="convert.second.d">
                    </fieldset>
                </div>
                <div class="form-cell">
                    <b>=</b>
                </div>
                <div class="form-cell wide-form-cell">
                    <input type="number" step="any" placeholder="Decimal" ng-model="convert.third.decimal">
                </div>
            </div>
            <div>
                <button class="pure-button pure-button-primary" ng-click="convertFractions()">Convert
                </button>
                <button class="pure-button pure-button-primary" ng-click="clearConverter()">Clear
                </button>
            </div>
            <div class="alert" ng-show="convert.error !== undefined">
                <div class="alert_inner">
                    <div class="alert_text">{{convert.error}}</div>
                    <div class="alert_dismiss" ng-click="convert.error = undefined">&times;</div>
                </div>
            </div>
        </fieldset>
    </form>

    <div class="pure-g">
        <div class="pure-u-1 pure-u-md-1-3 text">
            <h4>Lorem Ipsum</h4>

            <p>
                Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
                dolore magna aliqua. Ut enim ad minim veniam.
            </p>
        </div>
        <div class="pure-u-1 pure-u-md-1-3 text">
            <h4>Lorem Ipsum</h4>

            <p>
                Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
                dolore magna aliqua. Ut enim ad minim veniam.
            </p>
        </div>
        <div class="pure-u-1 pure-u-md-1-3 text">
            <h4>Lorem Ipsum</h4>

            <p>
                Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
                dolore magna aliqua. Ut enim ad minim veniam.
            </p>
        </div>
    </div>
</div>


