<script type="text/javascript-lazy">
    var app = angular.module('ctw');
    app.controllerProvider.register('toolController', function ($scope) {
        var initial = {
            //3 of the following:
            principal: undefined,
            years: undefined,
            interest: undefined,
            target: undefined,

            //completely optional:
            monthly: undefined,
            interval: undefined,

            //Variable-step
            result: [],
            error: undefined
        }
        $scope.investment = angular.copy(initial);

        $scope.calculate = function () {
            var scope = $scope.investment;
            //Die Inputs einem nach dem anderen validieren und sobald ein nicht validierbarer gefunden wurde Versuchen diesen auszurechnen
            validInputs = {
                principal: validateDecimal(scope.principal),
                years: validateDecimal(scope.years),
                interest: validateDecimal(scope.interest),
                target: validateDecimal(scope.target)
            }

            if(validInputs.principal && validInputs.years && validInputs.interest && !validInputs.target){
                console.log("calcu");
                var i = scope.interest / (scope.interval||1) / 1000;
                var n = (scope.interval||1) * scope.years;

                console.log(i);
                console.log(n);



                scope.target = Math.pow(1 + i,n) * scope.principal;
                console.log(scope.target)
            } else if(validInputs.principal && validInputs.years && !validInputs.interest && validInputs.target){
                scope.interest = Math.pow(scope.target / scope.principal, (1/scope.years) - 1);
            } else if(validInputs.principal && !validInputs.years && validInputs.interest && validInputs.target){
                scope.years = 1 / (log(scope.interest,scope.target / scope.principal) + 1);
            } else if(!validInputs.principal && validInputs.years && validInputs.interest && validInputs.target){
                scope.principal = 1 / (Math.pow(scope.interest,1 / ((1/scope.years) - 1)))  * scope.target;
            }else{
                scope.error = 'Please fill out exactly three of the top four inputs. Click clear to clear the form';
                return;
            }
        }
        $scope.reset = function () {
            $scope.investment = angular.copy(initial);
        }

        var validateInput = function () {
            invalidInput = undefined;

            //TODO für alle inputs: if input undefined und noch kein invalidInput gefunden ... falls schon ein invalidInput return false ansonsten am ende return invalidInpzut und dann mit switch case ausrechnen
            //...monthly can aber 0 sein ... nochmal überdenken
        }
        var validateDecimal = function (decimal) {
            decimal = parseFloat(decimal);
            return angular.isNumber(decimal) && isFinite(decimal);
        }
        var log = function(n,base){
            return Math.log(n)/(base ? Math.log(base) : 1);
        }
    });
</script>
<style>
    #form-wrapper {
        text-align: center;
    }
</style>
<h3>Investment & Savings Calculator</h3>
<div ng-controller="toolController">
    <div id="form-wrapper">
        <form class="pure-form pure-form-aligned" novalidate>
            <fieldset>
                <legend>Leave empty what you want to know</legend>
                <div class="pure-control-group">
                    <label for="principal" class="label">initial amount</label>
                    <input id="principal" type="number" step="any" placeholder="amount"
                           ng-model="investment.principal"/>
                </div>
                <div class="pure-control-group">
                    <label for="years" class="label">years</label>
                    <input id="years" type="number" step="any" placeholder="years" ng-model="investment.years"/>
                </div>
                <div class="pure-control-group">
                    <label for="interest" class="label">interest rate</label>
                    <input id="interest" type="number" step="any" placeholder="%" ng-model="investment.interest"/>
                </div>
                <div class="pure-control-group">
                    <label for="target" class="label">future value</label>
                    <input id="target" type="number" step="any" placeholder="amount" ng-model="investment.target"/>
                </div>
            </fieldset>
            <fieldset>
                <legend>Additional information (optional)</legend>
                <div class="pure-control-group">
                    <label for="monthly" class="label">monthly addition</label>
                    <input id="monthly" type="number" step="any" placeholder="amount (0)"
                           ng-model="investment.monthly"/>
                </div>
                <div class="pure-control-group">
                    <label for="compound" class="label">compound interest</label>
                    <input id="compound" type="number" step="any" placeholder="annually (1)"
                           ng-model="investment.interval"/>
                </div>

                <div>
                    <button class="pure-button pure-button-primary" ng-click="calculate()">Calculate
                    </button>
                    <button class="pure-button" type="reset" ng-click="reset()">Clear
                    </button>
                </div>
                <div class="alert" ng-show="investment.error !== undefined">
                    <div class="alert_inner">
                        <div class="alert_text">{{investment.error}}</div>
                        <div class="alert_dismiss" ng-click="investment.error = undefined">&times;</div>
                    </div>
                </div>
            </fieldset>
        </form>
    </div>
</div>
<hr/>
<div class="pure-g">
    <div class="pure-u-1 pure-u-md-1-3 text">
        <h4>Keywords</h4>

        <p>
            Investment, Savings, Future Value, ROI, compound interest
        </p>
    </div>
    <div class="pure-u-1 pure-u-md-1-3 text">
        <h4>Lorem Ipsum</h4>

        <p>
            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
            dolore magna aliqua. Ut enim ad minim veniam.
        </p>
    </div>
    <div class="pure-u-1 pure-u-md-1-3 text">
        <h4>Lorem Ipsum</h4>

        <p>
            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
            dolore magna aliqua. Ut enim ad minim veniam.
        </p>
    </div>
</div>
</div>


